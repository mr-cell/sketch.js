!function(){var a=[].slice;!function(b){var c;return b.fn.sketch=function(){var d,e,f;return e=arguments[0],d=2<=arguments.length?a.call(arguments,1):[],this.length>1&&b.error("Sketch.js can only be called on one element at a time."),f=this.data("sketch"),"string"==typeof e&&f?f[e]?"function"==typeof f[e]?f[e].apply(f,d):0===d.length?f[e]:1===d.length?f[e]=d[0]:void 0:b.error("Sketch.js did not recognize the given command."):f?f:(this.data("sketch",new c(this.get(0),e)),this)},c=function(){function a(a,c){this.el=a,this.canvas=b(a),this.context=a.getContext("2d"),this.options=b.extend({toolLinks:!0,defaultTool:"marker",defaultColor:"#000000",defaultSize:5,defaultStyle:"solid"},c),this.painting=!1,this.color=this.options.defaultColor,this.size=this.options.defaultSize,this.tool=this.options.defaultTool,this.style=this.options.defaultStyle,this.text="",this.actions=[],this.undoneActions=[],this.action=[],this.lineAction=[],this.linePainting=!1,this.circleAction=[],this.circlePainting=!1,this.rectAction=[],this.rectPainting=!1,this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent),this.options.toolLinks&&b("body").delegate('a[href="#'+this.canvas.attr("id")+'"]',"click",function(){var c,d,e,f,g,h,i;for(d=b(this),c=b(d.attr("href")),i=c.data("sketch"),h=["color","size","tool","style"],e=0,g=h.length;g>e;e++)f=h[e],d.attr("data-"+f)&&i.set(f,b(this).attr("data-"+f));return b(this).attr("data-download")&&i.download(b(this).attr("data-download")),!1})}return a.prototype.download=function(a){var b;return a||(a="png"),"jpg"===a&&(a="jpeg"),b="image/"+a,window.open(this.el.toDataURL(b))},a.prototype.set=function(a,b){return this[a]=b,this.canvas.trigger("sketch.change"+a,b)},a.prototype.startPainting=function(){return this.painting=!0,this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),style:this.style,events:[]}},a.prototype.stopPainting=function(){return this.action&&this.actions.push(this.action),this.painting=!1,this.action=null,this.redraw()},a.prototype.startLine=function(){return this.linePainting=!0,this.lineAction={tool:this.tool,color:this.color,size:parseFloat(this.size),style:this.style,events:[]}},a.prototype.stopLine=function(){return this.lineAction&&this.actions.push(this.lineAction),this.linePainting=!1,this.lineAction=null,this.redraw()},a.prototype.startCircle=function(){return this.circlePainting=!0,this.circleAction={tool:this.tool,color:this.color,size:parseFloat(this.size),style:this.style,events:[]}},a.prototype.stopCircle=function(){return this.circleAction&&this.actions.push(this.circleAction),this.circlePainting=!1,this.circleAction=null,this.redraw()},a.prototype.startRect=function(){return this.rectPainting=!0,this.rectAction={tool:this.tool,color:this.color,size:parseFloat(this.size),style:this.style,events:[]}},a.prototype.stopRect=function(){return this.rectAction&&this.actions.push(this.rectAction),this.rectPainting=!1,this.rectAction=null,this.redraw()},a.prototype.pointDistance=function(a,b){var c,d;return c=b.x-a.x,d=b.y-a.y,Math.sqrt(c*c+d*y2)},a.prototype.calculateLineStyle=function(a,b){var c;return c=[],"dashed"===a?(c[0]=3*b,c[1]=3*b):"dotted"===a&&(c[0]=1,c[1]=2*b),c},a.prototype.drawArrowAtBeginningOfLine=function(a,b,c,d,e){var f,g;return g=1-Math.atan2(c-a,d-b),f=1-Math.atan2(d-b,c-a),this.context.moveTo(a,b),this.context.lineTo(c-e*Math.cos(g),d-e*Math.sin(g)),this.context.moveTo(c,d),this.context.lineTo(c-e*Math.sin(f),d-e*Math.cos(f))},a.prototype.drawArrowAtEndOfLine=function(a,b,c,d,e){var f,g;return g=1-Math.atan2(c-a,d-b),f=1-Math.atan2(d-b,c-a),this.context.moveTo(c,d),this.context.lineTo(c-e*Math.cos(g),d-e*Math.sin(g)),this.context.moveTo(c,d),this.context.lineTo(c-e*Math.sin(f),d-e*Math.cos(f))},a.prototype.onEvent=function(a){return a.originalEvent&&a.originalEvent.targetTouches&&(a.pageX=a.originalEvent.targetTouches[0].pageX,a.pageY=a.originalEvent.targetTouches[0].pageY),b.sketch.tools[b(this).data("sketch").tool].onEvent.call(b(this).data("sketch"),a),a.preventDefault(),!1},a.prototype.redraw=function(){var a;return this.context=this.el.getContext("2d"),this.context.clearRect(0,0,this.el.width,this.el.height),a=this,b.each(this.actions,function(){return this.tool?b.sketch.tools[this.tool].draw.call(a,this):void 0}),this.painting&&this.action?b.sketch.tools[this.action.tool].draw.call(a,this.action):this.linePainting&&this.lineAction?b.sketch.tools[this.lineAction.tool].draw.call(a,this.lineAction):this.circlePainting&&this.circleAction?b.sketch.tools[this.circleAction.tool].draw.call(a,this.circleAction):this.rectPainting&&rectAction?b.sketch.tools[this.rectAction.tool].draw.call(a,this.rectAction):void 0},a}(),b.sketch={tools:{}},b.sketch.tools.marker={onEvent:function(a){switch(a.type){case"mousedown":case"touchstart":this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}return this.painting?(this.action.events.push({x:a.pageX-this.canvas.offset().left,y:a.pageY-this.canvas.offset().top,event:a.type}),this.redraw()):void 0},draw:function(a){var b,c,d,e,f,g;for(this.context.lineJoin="round",this.context.lineCap="round",e=this.calculateLineStyle(a.style,a.size),this.context.beginPath(),this.context.setLineDash(e),this.context.moveTo(a.events[0].x,a.events[0].y),g=a.events,c=0,d=g.length;d>c;c++)b=g[c],this.context.lineTo(b.x,b.y),f=b;return this.context.strokeStyle=a.color,this.context.lineWidth=a.size,this.context.stroke()}},b.sketch.tools.line={onEvent:function(a){switch(a.type){case"mousedown":case"touchstart":this.startLine();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopLine()}return this.linePainting?(this.lineAction.events.length>1&&this.lineAction.events.pop(),this.lineAction.events.push({x:a.pageX-this.canvas.offset().left,y:a.pageY-this.canvas.offset().top,event:a.type}),this.redraw()):void 0},draw:function(a){var b,c,d,e,f,g;for(this.context.lineJoin="round",this.context.lineCap="round",e=this.calculateLineStyle(a.style,a.size),this.context.beginPath(),this.context.setLineDash(e),this.context.moveTo(a.events[0].x,a.events[0].y),g=a.events,c=0,d=g.length;d>c;c++)b=g[c],a.drawStartAction&&this.drawArrowAtBeginningOfLine(a.events[0].x,a.events[0].y(b.x,b.y,4*a.size)),this.context.lineTo(b.x,b.y),this.drawArrowAtEndOfLine(a.events[0].x,a.events[0].y,b.x,b.y,4*a.size)(a.drawEndArrow?f=b:void 0);return this.context.strokeStyle=a.color,this.context.lineWidth=a.size,this.context.stroke()}},b.sketch.tools.arrow_line={onEvent:function(){return b.sketch.tools.line.onEvent.call(this,each)},draw:function(a){return a.drawEndArrow=!0,b.sketch.tools.line.draw.call(this,a)}},b.sketch.tools.double_arrow_line={onEvent:function(){return b.sketch.tools.line.onEvent.call(this,each)},draw:function(a){return a.drawStartArrow=!0,a.drawEndArrow=!0,b.sketch.tools.line.draw.call(this,a)}},b.sketch.tools.circle={onEvent:function(a){switch(a.type){case"mousedown":case"touchstart":this.startCircle();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopCircle()}return this.circlePainting?(this.circleAction.events.length>1&&this.circleAction.events.pop(),this.circleAction.events.push({x:a.pageX-this.canvas.offset().left,y:a.pageY-this.canvas.offset().top,event:a.type}),this.redraw()):void 0},draw:function(a){var b,c,d,e,f,g,h;for(this.context.lineJoin="round",this.context.lineCap="round",e=this.calculateLineStyle(a.style,a.size),this.context.beginPath(),this.context.setLineDash(e),h=a.events,c=0,d=h.length;d>c;c++)b=h[c],g=this.pointDistance({x:a.events[0].x,y:a.events[0].y},{x:b.x,y:b.y}),this.context.arc(a.events[0].x,a.events[0].y,g,0,2*Math.PI),f=b;return this.context.strokeStyle=a.color,this.context.lineWidth=a.size,this.context.stroke()}},b.sketch.tools.rectangle={onEvent:function(a){switch(a.type){case"mousedown":case"touchstart":this.startRect();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopRect()}return this.rectPainting?(this.rectAction.events.length>1&&this.rectAction.events.pop(),this.rectAction.events.push({x:a.pageX-this.canvas.offset().left,y:a.pageY-this.canvas.offset().top,event:a.type}),this.redraw()):void 0},draw:function(a){var b,c,d,e,f,g,h,i;for(this.context.lineJoin="round",this.context.lineCap="round",f=this.calculateLineStyle(a.style,a.size),this.context.beginPath(),this.context.setLineDash(f),h=a.events,d=0,e=h.length;e>d;d++)b=h[d],i=b.x-a.events[0].x,c=b.y-a.events[0].y,this.context.rect(a.events[0].x,a.events[0].y,i,c),g=b;return this.context.strokeStyle=a.color,this.context.lineWidth=a.size,this.context.stroke()}},this.sketch.tools.text={onEvent:function(a){switch(a.type){case"mouseup":case"touchend":this.action={tool:this.tool,color:this.color,text:this.text,size:parseFloat(this.size),events:[]},this.action.events.push({x:a.pageX-this.canvas.offset().left,y:a.pageY-this.canvas.offset().top,event:a.type}),this.actions.push(this.action),this.action=null}return this.redraw()},draw:function(a){var b,c,d,e,f,g;for(this.context.font="20px SansSerif",this.context.fillStyle=a.color,f=a.events,g=[],c=0,d=f.length;d>c;c++)b=f[c],this.context.fillText(a.text,b.x,b.y),g.push(e=b);return g}},b.sketch.tools.undo={onEvent:function(a){var b;switch(a.type){case"mouseup":case"touchend":b=this.actions.pop(),b&&this.undoneActions.push(b)}return this.redraw()},draw:function(){}},b.sketch.tools.redo={onEvent:function(a){var b;switch(a.type){case"mouseup":case"touchend":b=this.undoneActions.pop(),b&&actions.push(b)}return this.redraw()},draw:function(){}},b.sketch.tools.eraser={onEvent:function(a){return b.sketch.tools.marker.onEvent.call(this,a)},draw:function(a){var c;return c=this.context.globalCompositeOperation,this.context.globalCompositeOperation="destination-out",a.color="rgba(0,0,0,1)",b.sketch.tools.marker.draw.call(this,a),this.context.globalCompositeOperation=c}}}(jQuery)}.call(this);